(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.plugins,i=window.wp.editPost,s=window.wp.components,n=window.wp.element,l=window.wp.i18n,r=window.wp.apiFetch;var o=e.n(r);const c=window.wp.data;(0,a.registerPlugin)("geoai-sidebar",{render:()=>{const[e,a]=(0,n.useState)(!1),[r,d]=(0,n.useState)(null),[m,g]=(0,n.useState)(null),[u,p]=(0,n.useState)(null),[y,E]=(0,n.useState)(!1),_=(0,c.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),w=(0,n.useCallback)(async()=>{if(_){E(!0);try{const e=await o()({path:`/geoai/v1/audit/${_}`,method:"GET"});e.success?d(e.data):d(null)}catch(e){404===e?.data?.status?d(null):g(e.message||(0,l.__)("An error occurred","geo-ai"))}finally{E(!1)}}},[_]);(0,n.useEffect)(()=>{w()},[w]);const f=r?.suggestions?.titleOptions&&r.suggestions.titleOptions.length>0,v=r?.suggestions?.entities&&r.suggestions.entities.length>0,x=r?.suggestions?.citations&&r.suggestions.citations.length>0;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(i.PluginSidebarMoreMenuItem,{target:"geoai-sidebar"},(0,l.__)("GEO AI","geo-ai")),(0,t.createElement)(i.PluginSidebar,{name:"geoai-sidebar",title:(0,l.__)("GEO AI Audit","geo-ai")},(0,t.createElement)(s.PanelBody,null,(0,t.createElement)(s.Button,{isPrimary:!0,onClick:async()=>{a(!0),g(null),p(null);try{const e=await o()({path:"/geoai/v1/audit",method:"POST",data:{post_id:_}});e.success?(d(e.data),p({status:"success",message:(0,l.__)("Audit completed successfully.","geo-ai")})):g(e.message||(0,l.__)("Audit failed","geo-ai"))}catch(e){g(e.message||(0,l.__)("An error occurred","geo-ai"))}finally{a(!1)}},disabled:e,style:{width:"100%",marginBottom:"16px"}},e?(0,t.createElement)(s.Spinner,null):(0,l.__)("Run AI Audit","geo-ai")),u&&(0,t.createElement)(s.Notice,{status:u.status,isDismissible:!1,style:{marginBottom:"12px"}},u.message),m&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!1},m),r?.runAt&&(0,t.createElement)("div",{style:{marginBottom:"12px",fontSize:"12px",color:"#555",display:"flex",justifyContent:"space-between",gap:"8px",alignItems:"center"}},(0,t.createElement)("span",null,(0,l.__)("Last audited:","geo-ai")," ",new Date(r.runAt).toLocaleString()),(0,t.createElement)(s.Button,{isSecondary:!0,isSmall:!0,onClick:w,disabled:y},y?(0,l.__)("Refreshingâ€¦","geo-ai"):(0,l.__)("Refresh","geo-ai"))),!r&&!y&&(0,t.createElement)("div",{style:{fontSize:"13px",color:"#666",marginBottom:"16px"}},(0,l.__)("Run your first audit to see AI-driven suggestions tailored to answer engine visibility.","geo-ai")),r&&(0,t.createElement)("div",{className:"geoai-audit-results"},(0,t.createElement)("div",{className:"geoai-score-dial",style:{textAlign:"center",padding:"20px",marginBottom:"16px"}},(0,t.createElement)("div",{style:{fontSize:"48px",fontWeight:"bold",color:(h=r.scores.total,h>=80?"#46b450":h>=60?"#ffb900":"#dc3232")}},r.scores.total),(0,t.createElement)("div",{style:{fontSize:"14px",color:"#666"}},(0,l.__)("Overall Score","geo-ai"))),(0,t.createElement)("div",{style:{marginBottom:"16px"}},(0,t.createElement)("strong",null,(0,l.__)("Score Breakdown:","geo-ai")),(0,t.createElement)("ul",{style:{listStyle:"none",padding:0}},(0,t.createElement)("li",null,(0,l.__)("Answerability:","geo-ai")," ",r.scores.answerability),(0,t.createElement)("li",null,(0,l.__)("Structure:","geo-ai")," ",r.scores.structure),(0,t.createElement)("li",null,(0,l.__)("Trust:","geo-ai")," ",r.scores.trust),(0,t.createElement)("li",null,(0,l.__)("Technical:","geo-ai")," ",r.scores.technical))),r.issues&&r.issues.length>0&&(0,t.createElement)("div",null,(0,t.createElement)("strong",null,(0,l.__)("Issues:","geo-ai")),(0,t.createElement)("ul",{style:{listStyle:"none",padding:0}},r.issues.map((e,a)=>(0,t.createElement)("li",{key:a,style:{marginBottom:"12px",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}},(0,t.createElement)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"4px"}},(0,t.createElement)("span",{style:{color:"high"===e.severity?"#dc3232":"med"===e.severity?"#ffb900":"#46b450",fontWeight:"bold"}},e.severity.toUpperCase())),(0,t.createElement)("div",null,e.msg),e.quickFix&&(0,t.createElement)(s.Button,{isSmall:!0,isSecondary:!0,onClick:()=>(async e=>{p(null),g(null);try{const t=await o()({path:"/geoai/v1/quick-fix",method:"POST",data:{post_id:_,fix_id:e}});t.success?(p({status:"success",message:t.message||(0,l.__)("Quick fix applied successfully.","geo-ai")}),await w()):g(t.message||(0,l.__)("Quick fix failed","geo-ai"))}catch(e){g(e.message||(0,l.__)("An error occurred","geo-ai"))}})(e.quickFix),style:{marginTop:"8px"}},(0,l.__)("Apply Quick Fix","geo-ai")))))),(f||v||x)&&(0,t.createElement)("div",{style:{marginTop:"16px"}},(0,t.createElement)("strong",null,(0,l.__)("AI Suggestions","geo-ai")),f&&(0,t.createElement)("div",{style:{marginTop:"12px"}},(0,t.createElement)("div",{style:{fontWeight:"600",marginBottom:"4px"}},(0,l.__)("Meta Title Ideas","geo-ai")),(0,t.createElement)("ul",{style:{listStyle:"disc",paddingLeft:"20px",margin:0}},r.suggestions.titleOptions.map((e,a)=>(0,t.createElement)("li",{key:`title-${a}`},e)))),v&&(0,t.createElement)("div",{style:{marginTop:"12px"}},(0,t.createElement)("div",{style:{fontWeight:"600",marginBottom:"4px"}},(0,l.__)("Relevant Entities","geo-ai")),(0,t.createElement)("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"}},r.suggestions.entities.map((e,a)=>(0,t.createElement)("span",{key:`entity-${a}`,style:{background:"#f0f0f0",borderRadius:"12px",padding:"4px 10px",fontSize:"12px"}},e)))),x&&(0,t.createElement)("div",{style:{marginTop:"12px"}},(0,t.createElement)("div",{style:{fontWeight:"600",marginBottom:"4px"}},(0,l.__)("Suggested Citations","geo-ai")),(0,t.createElement)("ul",{style:{listStyle:"disc",paddingLeft:"20px",margin:0}},r.suggestions.citations.map((e,a)=>(0,t.createElement)("li",{key:`citation-${a}`},(0,t.createElement)("a",{href:e,target:"_blank",rel:"noreferrer"},e))))))))));var h},icon:"search"});const d=window.wp.blocks,m=window.wp.blockEditor,g=JSON.parse('{"UU":"geoai/answer-card"}');(0,d.registerBlockType)(g.UU,{edit:function({attributes:e,setAttributes:a}){const{tldr:i,keyFacts:n}=e;return(0,t.createElement)("div",{...(0,m.useBlockProps)()},(0,t.createElement)("div",{className:"geoai-answer-card geoai-answer-card-editor"},(0,t.createElement)("div",{className:"geoai-answer-card-header"},(0,t.createElement)("h3",null,(0,l.__)("TL;DR","geo-ai"))),(0,t.createElement)("div",{className:"geoai-answer-card-body"},(0,t.createElement)(m.RichText,{tagName:"p",value:i,onChange:e=>a({tldr:e}),placeholder:(0,l.__)("Enter a concise summary (max 200 words)...","geo-ai"),className:"geoai-answer-card-tldr"}),(0,t.createElement)("div",{className:"geoai-answer-card-facts"},(0,t.createElement)("h4",null,(0,l.__)("Key Facts","geo-ai")),(0,t.createElement)("ul",null,n.map((e,i)=>(0,t.createElement)("li",{key:i},(0,t.createElement)(m.RichText,{tagName:"span",value:e,onChange:e=>((e,t)=>{const i=[...n];i[e]=t,a({keyFacts:i})})(i,e),placeholder:(0,l.__)("Enter key fact...","geo-ai")}),(0,t.createElement)(s.Button,{isSmall:!0,isDestructive:!0,onClick:()=>(e=>{const t=n.filter((t,a)=>a!==e);a({keyFacts:t})})(i)},(0,l.__)("Remove","geo-ai"))))),(0,t.createElement)(s.Button,{isPrimary:!0,isSmall:!0,onClick:()=>{a({keyFacts:[...n,""]})}},(0,l.__)("Add Key Fact","geo-ai"))))))},save:function({attributes:e}){const{tldr:a,keyFacts:i}=e;return(0,t.createElement)("div",{...m.useBlockProps.save()},(0,t.createElement)("div",{className:"geoai-answer-card"},(0,t.createElement)("div",{className:"geoai-answer-card-header"},(0,t.createElement)("h3",null,(0,l.__)("TL;DR","geo-ai"))),(0,t.createElement)("div",{className:"geoai-answer-card-body"},(0,t.createElement)(m.RichText.Content,{tagName:"p",value:a,className:"geoai-answer-card-tldr"}),i&&i.length>0&&(0,t.createElement)("div",{className:"geoai-answer-card-facts"},(0,t.createElement)("h4",null,(0,l.__)("Key Facts","geo-ai")),(0,t.createElement)("ul",null,i.map((e,a)=>(0,t.createElement)("li",{key:a},(0,t.createElement)(m.RichText.Content,{tagName:"span",value:e}))))))))},title:(0,l.__)("Answer Card","geo-ai"),description:(0,l.__)("A concise TL;DR summary with key facts optimized for AI answer engines.","geo-ai"),icon:"info"})})();